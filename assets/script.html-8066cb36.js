import{_ as l}from"./console-68d84367.js";import{_ as u,X as r,Y as d,Z as n,a0 as s,$ as a,a1 as k,a2 as e,B as o}from"./framework-e053119e.js";const h="/fast-request/img/script.png",g="/fast-request/img/2022.2.3/scriptDonate.png",m={},v=n("p",null,[n("strong",null,"脚本的作用"),s(": 开发者可以利用 Groovy 脚本来自定义一些逻辑,从而使得 api 更加灵活,例如对参数进行动态加密签名,放入 header,而不是直接写死")],-1),_=n("strong",null,"实现技术",-1),f={href:"https://groovy-lang.org/",target:"_blank",rel:"noopener noreferrer"},b=n("p",null,[s("看到 Groovy 不熟悉请"),n("mark",null,"不要慌"),s(",语法和 Java 几乎一致(Java 就是香,手动一个狗头)")],-1),x=n("h2",{id:"脚本流程图",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#脚本流程图","aria-hidden":"true"},"#"),s(" 脚本流程图")],-1),y=n("h2",{id:"测试项目",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#测试项目","aria-hidden":"true"},"#"),s(" 测试项目")],-1),q={href:"https://github.com/kings1990/fast-request-samples",target:"_blank",rel:"noopener noreferrer"},U=e(`<h2 id="案例" tabindex="-1"><a class="header-anchor" href="#案例" aria-hidden="true">#</a> 案例</h2><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> 往 header 塞入 md5 签名</label></li></ul><div class="language-groovy" data-ext="groovy"><pre class="language-groovy"><code><span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>CharsetUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>StrUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>DigestUtil

String body <span class="token operator">=</span> StrUtil<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">bodyBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CharsetUtil<span class="token punctuation">.</span>CHARSET_UTF_8<span class="token punctuation">)</span>
body <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;xxx&quot;</span></span><span class="token comment">//just for test</span>
String sign <span class="token operator">=</span> DigestUtil<span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;sign&quot;</span></span><span class="token punctuation">,</span>sign<span class="token punctuation">)</span>
</code></pre></div><h2 id="内置变量" tabindex="-1"><a class="header-anchor" href="#内置变量" aria-hidden="true">#</a> 内置变量</h2><div class="hint-container danger"><p class="hint-container-title">注意</p><p>开发者在自己编辑的脚本中,应该注意内置变量已被声明,而不是再去 new 一个 Request 或者 Response 对象,对象名是 request 或者 response,否则可能会造成不可预期的错误</p></div>`,5),w={href:"https://hutool.cn/",target:"_blank",rel:"noopener noreferrer"},S=n("code",null,"cn.hutool.http.HttpRequest",-1),j={id:"request",tabindex:"-1"},H=n("a",{class:"header-anchor",href:"#request","aria-hidden":"true"},"#",-1),R=n("ul",null,[n("li",null,"作用: 包含了请求相关的信息,例如 url、header、body、各种参数"),n("li",null,"类型: cn.hutool.http.HttpRequest")],-1),C=n("p",null,"可以通过修改 request 值来动态调整参数",-1),N={id:"response",tabindex:"-1"},B=n("a",{class:"header-anchor",href:"#response","aria-hidden":"true"},"#",-1),D=n("ul",null,[n("li",null,"作用: 包含了请求响应的信息"),n("li",null,"类型: cn.hutool.http.HttpResponse")],-1),J=n("p",null,"可以通过 response 值来获取响应的结果",-1),I={id:"rfr",tabindex:"-1"},L=n("a",{class:"header-anchor",href:"#rfr","aria-hidden":"true"},"#",-1),P=n("ul",null,[n("li",null,"作用: 包含了跟插件交互相关的一些属性,用于后期定制")],-1),A={id:"rfr-projectheader",tabindex:"-1"},G=n("a",{class:"header-anchor",href:"#rfr-projectheader","aria-hidden":"true"},"#",-1),z=n("div",{class:"language-text","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`作用: 包含了项目级别头,可以通过修改来动态往UI里面设置值
类型: java.util.LinkedHashMap
`)])],-1),E={id:"rfr-moduleheader",tabindex:"-1"},Q=n("a",{class:"header-anchor",href:"#rfr-moduleheader","aria-hidden":"true"},"#",-1),V=n("div",{class:"language-text","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`作用: 包含了模块级别头,可以通过修改来动态往UI里面设置值
类型: java.util.LinkedHashMap
`)])],-1),T={id:"rfr-currentprojectname",tabindex:"-1"},M=n("a",{class:"header-anchor",href:"#rfr-currentprojectname","aria-hidden":"true"},"#",-1),O=n("div",{class:"language-text","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`作用: 当前下拉框选择的项目名
类型: java.lang.String
`)])],-1),F={id:"rfr-currentenvname",tabindex:"-1"},W=n("a",{class:"header-anchor",href:"#rfr-currentenvname","aria-hidden":"true"},"#",-1),Y=n("div",{class:"language-text","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`作用: 当前下拉框选择的环境名称
类型: java.lang.String
`)])],-1),Z={id:"rfr-currentdomain",tabindex:"-1"},K=n("a",{class:"header-anchor",href:"#rfr-currentdomain","aria-hidden":"true"},"#",-1),X=n("div",{class:"language-text","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`作用: 获取当前作用的域名
类型: java.lang.String
`)])],-1),$={id:"rfr-currentmodulename",tabindex:"-1"},nn=n("a",{class:"header-anchor",href:"#rfr-currentmodulename","aria-hidden":"true"},"#",-1),sn=e(`<div class="language-text" data-ext="text"><pre class="language-text"><code>作用: 获取当前API的模块名
类型: java.lang.String
</code></pre></div><h2 id="引入第三方-jar" tabindex="-1"><a class="header-anchor" href="#引入第三方-jar" aria-hidden="true">#</a> 引入第三方 Jar</h2><div class="hint-container tip"><p class="hint-container-title">内置的 Jar</p><div class="language-text" data-ext="text"><pre class="language-text"><code>com.alibaba:fastjson:1.2.78
cn.hutool:hutool-all:5.8.5
com.google.guava:guava:30.1.1-jre
</code></pre></div><p>Jar 的版本会不定期更新,如果发现 bug 请联系作者要求作者升级</p><p>开发者可以利用以上 3 个 Jar 所提供的工具方法,直接在脚本中引用,不需要再依赖第三方的 Jar(hutool 就是香,已经加入许多工具类)</p></div><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> 引入 jar(maven 形式)</label></li></ul><p>下载 jar 可能会需要花费额外的时间</p><div class="language-groovy" data-ext="groovy"><pre class="language-groovy"><code><span class="token annotation punctuation">@Grab</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;org.apache.commons:commons-lang3:3.12.0&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>StringUtils

String debug <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;debug&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>debug<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//some logic</span>
<span class="token punctuation">}</span>
</code></pre></div><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> 引入 jar(通过本地 jar)</label></li></ul><div class="language-groovy" data-ext="groovy"><pre class="language-groovy"><code><span class="token comment">//注意此处的file:前缀</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span><span class="token function">addURL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;file:/path/to/jar&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> StringUtils <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;org.apache.commons.lang3.StringUtils&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

String debug <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;debug&quot;</span></span><span class="token punctuation">)</span><span class="token comment">//获取header</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>debug<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//some logic</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="作用范围与顺序" tabindex="-1"><a class="header-anchor" href="#作用范围与顺序" aria-hidden="true">#</a> 作用范围与顺序</h2>`,9),an=n("code",null,"项目级别",-1),tn=n("code",null,"单API级别",-1),en=n("svg",{class:"icon svg-icon","aria-hidden":"true"},[n("use",{"xlink:href":"#icon-quanjucanshu"})],-1),on=n("p",null,"项目级别将作用项目中所有的API，单API级别只作用于单个API。",-1),pn=n("p",null,[s("执行顺序："),n("code",null,"项目级别"),s("->"),n("code",null,"单API级别")],-1),cn=n("p",null,[n("img",{src:h,alt:"scriptScope",loading:"lazy"})],-1),ln={id:"console",tabindex:"-1"},un=n("a",{class:"header-anchor",href:"#console","aria-hidden":"true"},"#",-1),rn=e(`<p>Console 帮助开发者打印一些你想要的信息</p><div class="language-java" data-ext="java"><pre class="language-java"><code>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;print info&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p><img src="`+l+'" alt="console" loading="lazy"></p><h2 id="demo" tabindex="-1"><a class="header-anchor" href="#demo" aria-hidden="true">#</a> Demo</h2>',4),dn={class:"hint-container tip"},kn=n("p",{class:"hint-container-title"},"1. 签名参数",-1),hn=n("p",null,"在你的本地新建一个 xxx.groovy 文件,粘贴以下代码,适当修改后,能保证本地可以正常运行,再把代码粘贴到脚本中",-1),gn=e(`<p><s>HttpRequest request = HttpUtil.createPost(&quot;http://localhost:8081/book/add&quot;)</s></p><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code><span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>CharsetUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>StrUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>DigestUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpRequest
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpUtil

<span class="token comment">//注意、注意、注意,脚本中需要删除此行代码</span>
HttpRequest request <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">createPost</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;http://localhost:8081/book/add&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">//脚本逻辑正式开始</span>
String body <span class="token operator">=</span> StrUtil<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">bodyBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CharsetUtil<span class="token punctuation">.</span>CHARSET_UTF_8<span class="token punctuation">)</span>
body <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;xxxx&quot;</span></span><span class="token comment">//just for test</span>
String sign <span class="token operator">=</span> DigestUtil<span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;sign&quot;</span></span><span class="token punctuation">,</span>sign<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),mn=e(`<div class="hint-container tip"><p class="hint-container-title">2. 利用某一个请求的响应充当请求的 Header 参数</p><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code><span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>CharsetUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>StrUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>DigestUtil
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpRequest
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpResponse
<span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpUtil
<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSON

HttpRequest myRequest <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">createPost</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;http://localhost:8081/api/v1.0/login&quot;</span></span><span class="token punctuation">)</span>
HttpResponse myResponse <span class="token operator">=</span> myRequest<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>myResponse<span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    String token <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>myResponse<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;token&quot;</span></span><span class="token punctuation">)</span>
    request<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;token&quot;</span></span><span class="token punctuation">,</span>token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="注意点" tabindex="-1"><a class="header-anchor" href="#注意点" aria-hidden="true">#</a> 注意点</h2><ul><li>Groovy 脚本对 <mark>;</mark> 不敏感,Java 用;作为语句代码的结束,Groovy 用换行表示一句代码的结束</li><li>内置变量已被申明,例如 Demo2 中需要额外新建一个请求,变量命名需要注意不能与内置变量相同</li></ul><h2 id="脚本投稿" tabindex="-1"><a class="header-anchor" href="#脚本投稿" aria-hidden="true">#</a> 脚本投稿 🌟</h2><p>为了将脚本做的更加强大,评论区开放社区脚本投递,将强大脚本通过<strong>下方留言</strong> 的形式上报,让更多人使用你开发的脚本,同时如果使用者觉得社区开发者投递的脚本不错,请给该脚本 <mark>点赞</mark>,投票高且实用的脚本, 将有机会<mark>直接上墙到插件页面</mark>,从而让你的主页获得更高的关注度🔥</p><ul><li>格式</li></ul><div class="language-groovy" data-ext="groovy"><pre class="language-groovy"><code><span class="token comment">/**
 * 作者:Kings
 * 主页:https://github.com/kings1990
 * 功能:xxxxx
 */</span>

<span class="token comment">//脚本内容</span>
<span class="token punctuation">....</span>
</code></pre></div><p><img src="`+g+'" alt="scriptDonate" loading="lazy"></p>',8);function vn(_n,fn){const p=o("ExternalLinkIcon"),c=o("FlowChart"),t=o("Badge"),i=o("RouterLink");return r(),d("div",null,[v,n("p",null,[_,s(": "),n("a",f,[s("Groovy"),a(p)])]),b,x,a(c,{id:"flowchart-12",code:"eJwrLrG1Ky5JLCqxUggGUVz5BYa2dpl5BaUl+aUlQNJK4Wln7/O96160zHo2Zw1Q2giooTSpCCibmZdqpeCSr1CUWliaWgzSamxrl1+QWpRYkpmfB9Q4oQ+hMdXWLjUvxUrBNS+Fq7hEIym/pCQ/V1MXqN5QoygzPaMEzDZCYhvr2qVyAQDOaT9G",preset:"vue"}),y,n("p",null,[n("a",q,[s("https://github.com/kings1990/fast-request-samples"),a(p)])]),U,n("p",null,[s("插件底层采用"),n("a",w,[s("hutool"),a(p)]),s("的"),S,s("来实现请求的发送")]),n("h3",j,[H,s(" request "),a(t,{text:"2022.2.3️",type:"tip"})]),R,C,n("h3",N,[B,s(" response "),a(t,{text:"2022.2.3️",type:"tip"})]),D,J,n("h3",I,[L,s(" rfr "),a(t,{text:"2022.2.3️",type:"tip"})]),P,n("h4",A,[G,s(" rfr.projectHeader "),a(t,{text:"2022.2.3️",type:"tip"})]),z,n("h4",E,[Q,s(" rfr.moduleHeader "),a(t,{text:"2022.2.3️",type:"tip"})]),V,n("h4",T,[M,s(" rfr.currentProjectName "),a(t,{text:"2022.2.5️",type:"tip"})]),O,n("h4",F,[W,s(" rfr.currentEnvName "),a(t,{text:"2022.2.5️",type:"tip"})]),Y,n("h4",Z,[K,s(" rfr.currentDomain "),a(t,{text:"2022.3.1️",type:"tip"})]),X,n("h4",$,[nn,s(" rfr.currentModuleName "),a(t,{text:"2023.1.3️",type:"tip"})]),sn,n("p",null,[s("分为"),an,s("和"),tn,s("，项目全局作用需要点击 "),a(i,{to:"/guide/features/projectValueConfig.html"},{default:k(()=>[en,s(" 项目级别全局参数支持")]),_:1}),s(" 进行配置")]),on,pn,cn,n("h2",ln,[un,s(" Console "),a(t,{text:"2022.2.5",type:"tip"})]),rn,n("div",dn,[kn,hn,n("ul",null,[n("li",null,[a(t,{text:"注意最终脚本需要删除这行代码",type:"danger"})])]),gn]),mn])}const yn=u(m,[["render",vn],["__file","script.html.vue"]]);export{yn as default};
